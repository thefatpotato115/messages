<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Messages</title>
    <link rel="icon" href="favicon.png" type="image/png"> <!-- Favicon added here -->
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            text-align: center;
            padding: 20px;
        }
        h2 {
            font-weight: 600;
            color: #008080;
        }
        .message {
            background-color: #1e1e1e;
            color: #e0e0e0;
            border: 1px solid #008080;
            border-radius: 5px;
            padding: 10px;
            margin: 10px;
            text-align: left;
            position: relative;
        }
        .message:hover {
            text-decoration: line-through;
            cursor: pointer;
        }
        .message-time {
            font-size: 12px;
            color: #b0b0b0;
        }
    </style>
</head>
<body>
    <h2>Messages</h2>
    <div id="messageContainer"></div>

    <script>
        const backendUrl = "https://messages-7hn5.onrender.com";
        const messageContainer = document.getElementById("messageContainer");

        // Function to load and display messages
        function loadMessages() {
            fetch(`${backendUrl}/messages`)
                .then(response => response.json())
                .then(messages => {
                    messageContainer.innerHTML = ''; // Clear current messages
                    messages.forEach(message => {
                        const messageElement = document.createElement("div");
                        messageElement.classList.add("message");
                        messageElement.innerHTML = `
                            <p>${message.text}</p>
                            <p class="message-time">${getTimeAgo(message.timestamp)}</p>
                        `;
                        messageElement.onclick = () => deleteMessage(message._id);
                        
                        // Check if message is older than 5 minutes
                        if (isExpired(message.timestamp)) {
                            deleteMessage(message._id);
                        }

                        messageContainer.appendChild(messageElement);
                    });
                })
                .catch(err => console.error("Error loading messages:", err));
        }

        // Function to delete a message
        function deleteMessage(messageId) {
            fetch(`${backendUrl}/messages/${messageId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    loadMessages(); // Reload the messages after deletion
                } else {
                    console.error("Failed to delete message");
                }
            })
            .catch(err => console.error("Error deleting message:", err));
        }

        // Function to check if the message is expired (older than 5 minutes)
        function isExpired(timestamp) {
            const currentTime = new Date().getTime();
            const messageTime = new Date(timestamp).getTime();
            const fiveMinutesInMs = 5 * 60 * 1000;
            return currentTime - messageTime > fiveMinutesInMs;
        }

        // Function to format the time ago (e.g., "1 second ago")
        function getTimeAgo(timestamp) {
            const currentTime = new Date().getTime();
            const messageTime = new Date(timestamp).getTime();
            const differenceInSeconds = Math.floor((currentTime - messageTime) / 1000);
            
            if (differenceInSeconds < 14) {
                return `now`;
            } else if (differenceInSeconds < 60) {
                return `${differenceInSeconds} second${differenceInSeconds > 1 ? 's' : ''} ago`;
            } else if (differenceInSeconds < 3600) {
                const minutes = Math.floor(differenceInSeconds / 60);
                return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            } else if (differenceInSeconds < 86400) {
                const hours = Math.floor(differenceInSeconds / 3600);
                return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            } else {
                const days = Math.floor(differenceInSeconds / 86400);
                return `${days} day${days > 1 ? 's' : ''} ago`;
            }
        }

        // Load messages when the page is loaded
        loadMessages();
        setInterval(loadMessages, 30000); // Refresh messages every 30 seconds
    </script>
</body>
</html>